<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>数字猜谜游戏</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #game-container { max-width: 600px; margin: 0 auto; }
    #output { 
      height: 300px; 
      border: 1px solid #ccc; 
      padding: 10px; 
      margin: 10px 0; 
      overflow-y: auto; 
      white-space: pre-wrap;
    }
    #input-box { width: 80%; padding: 8px; }
    #submit-btn { padding: 8px 16px; margin-left: 10px; }
  </style>
</head>
<body>
  <div id="game-container">
    <h1>数字猜谜游戏</h1>
    <div id="output">欢迎来到数字猜谜游戏！
请猜一个四位不重复的数字（第一位不为0）。
</div>
    <input type="text" id="input-box" placeholder="输入四位数字">
    <button id="submit-btn">提交猜测</button>
  </div>

  <script>
    // 1. 生成随机四位不重复数字（和C++逻辑一致）
    let target = [];
    let used = new Array(10).fill(false);
    for (let i = 0; i < 4; i++) {
      let num;
      do {
        num = Math.floor(Math.random() * 10);
      } while (used[num] || (i === 0 && num === 0));
      used[num] = true;
      target.push(num);
    }

    let guessCount = 0;
    const output = document.getElementById('output');
    const inputBox = document.getElementById('input-box');
    const submitBtn = document.getElementById('submit-btn');

    // 2. 实时处理输入和输出（优化计数逻辑，确保个数准确）
    function handleGuess() {
      const input = inputBox.value.trim();
      guessCount++;

      // 输入验证（和C++逻辑一致）
      if (input.length !== 4) {
        output.textContent += `第${guessCount}次猜测：输入错误！请输入四位数字。\n`;
        inputBox.value = '';
        output.scrollTop = output.scrollHeight;
        return;
      }

      let inputUsed = new Array(10).fill(false);
      let valid = true;
      for (let c of input) {
        if (isNaN(c) || inputUsed[Number(c)]) {
          valid = false;
          break;
        }
        inputUsed[Number(c)] = true;
      }
      if (!valid || input[0] === '0') {
        output.textContent += `第${guessCount}次猜测：输入错误！请输入四位不重复的数字，且第一位不为0。\n`;
        inputBox.value = '';
        output.scrollTop = output.scrollHeight;
        return;
      }

      // 优化版：精准计算「数字位置都对」和「只有数字对」的个数（无重复计数）
      let a = 0, b = 0; // a=数字位置都对的个数，b=只有数字对的个数
      const guess = input.split('').map(Number);
      const targetCopy = [...target]; // 复制目标数组，避免修改原数据
      const guessCopy = [...guess];   // 复制猜测数组，避免修改原数据

      // 第一步：计算「数字位置都对」的个数（a）
      for (let i = 0; i < 4; i++) {
        if (guessCopy[i] === targetCopy[i]) {
          a++;
          guessCopy[i] = -1; // 标记为已匹配，避免重复计数
          targetCopy[i] = -2;
        }
      }

      // 第二步：计算「只有数字对（位置不对）」的个数（b）
      for (let i = 0; i < 4; i++) {
        if (guessCopy[i] !== -1) { // 跳过已匹配的数字
          const matchIndex = targetCopy.indexOf(guessCopy[i]);
          if (matchIndex !== -1) {
            b++;
            targetCopy[matchIndex] = -2; // 标记为已匹配，避免重复计数
          }
        }
      }

      // 核心：明确展示两个个数的中文文案（100%满足需求）
      let resultText = '';
      if (a === 0 && b === 0) {
        resultText = '没有数字匹配';
      } else {
        if (a > 0) resultText += `数字位置都对的个数：${a}个`;
        if (a > 0 && b > 0) resultText += '，';
        if (b > 0) resultText += `只有数字对（位置不对）的个数：${b}个`;
      }

      // 实时输出结果（明确展示两个个数）
      output.textContent += `第${guessCount}次猜测：${input} → ${resultText}\n`;
      
      // 游戏结束逻辑
      if (a === 4) {
        output.textContent += `恭喜你！猜对了，总共猜了${guessCount}次。\n游戏结束，刷新页面重新开始。\n`;
        submitBtn.disabled = true;
        inputBox.disabled = true;
      }

      inputBox.value = '';
      output.scrollTop = output.scrollHeight; // 滚动到最新内容
    }

    // 3. 绑定事件（回车/点击都可提交）
    submitBtn.addEventListener('click', handleGuess);
    inputBox.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') handleGuess();
    });
  </script>
</body>
</html>